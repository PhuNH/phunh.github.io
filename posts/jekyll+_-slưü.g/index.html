<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Interesting and/or useful things (to me)"><link rel="shortcut icon" href=https://phunh.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.609872059387950283d8b6ce9f9f1d1d35946704e753486966b9b6d2afe0ccc3.css><title>Jekyll slug and data files</title></head><body><header id=banner><h2><a href=https://phunh.github.io/posts/jekyll+_-sl%C6%B0%C3%BC.g/>Jekyll slug and data files</a></h2><nav><ul><li><a href=https://phunh.github.io>home</a></li><li><a class=active href=/posts/>posts</a></li><li><a href=/notes/>notes</a></li><li><a href=/tags/>tags</a></li><li><a href=/about/>about</a></li></ul></nav></header><main id=content><article><header id=post-header><small><time>Updated on 13 May 2020</time></small><div class=tagline>Phu
&emsp;|&emsp;5 minutes&emsp;|&emsp;Tags:
&nbsp;<a class=tag href=/tags/jekyll/>jekyll</a>
&nbsp;<a class=tag href=/tags/liquid/>liquid</a>
&nbsp;<a class=tag href=/tags/slug/>slug</a>
&nbsp;<a class=tag href=/tags/data-file/>data file</a></div></header><p>If you haven&rsquo;t seen it, the markdown file of this post is named &ldquo;<em>2020-05-12-{{page.slug | replace: &lsquo;</em>&rsquo;, &lsquo;_&rsquo;}}.md_&rdquo;. Why so?</p><h3 id=what-they-are>What they are</h3><p>A post in Jekyll is the result of parsing a file which is named with the structure</p><blockquote><p>&lt;year> - &lt;month> - &lt;day> - &lt;slug>.&lt;extension></p></blockquote><p>I only added spaces to make it clearer. There should be no space.</p><p>The Jekyll doc might call that &ldquo;slug&rdquo; part <a href=https://jekyllrb.com/docs/posts/#creating-posts>&ldquo;title&rdquo;</a> but when you write <code>{{page.slug}}</code>, what you get is that &ldquo;title&rdquo;. Oh sorry I forgot to add the <code>raw</code> tag. &ldquo;when you write <code>{{page.slug}}</code>&rdquo;.</p><p>I have only written 4 posts here (this is the fifth, but one has been moved to the newly created [Notes]({% link notes.html %}) section), and [one of them]({% post_url 2020-03-25-toggle-krunner-plasma-5.17 %}) contains a dot in its slug. Again, you don&rsquo;t see any dot in URLs around here, whether in this post&rsquo;s or that old post&rsquo;s, although I also use &ldquo;slug"s to build URLs. The reason is that &ldquo;slug"s to build URL and <code>page.slug</code>s are slugified differently.</p><p>Slugification (don&rsquo;t take my word for it!) is the act of converting strings to a form with no space and no &ldquo;strange&rdquo; characters. In Liquid, the <code>slugify</code> filter helps you do this. How &ldquo;strange&rdquo; characters are converted depends on which <a href=https://jekyllrb.com/docs/liquid/filters/#options-for-the-slugify-filter>option</a> you pass to the filter:</p><ul><li><code>{{page.slug | slugify}}</code> gives &ldquo;<em>{{page.slug | slugify}}</em>&rdquo; just like what you see in the address bar;</li><li><code>{{page.slug | slugify: "ascii"}}</code> gives &ldquo;<em>{{page.slug | slugify: &lsquo;ascii&rsquo;}}</em>&rdquo;, it&rsquo;s what I&rsquo;m gonna use with this site now;</li><li><code>{{page.slug | slugify: "latin"}}</code> gives &ldquo;<em>{{page.slug | slugify: &rsquo;latin&rsquo;}}</em>&rdquo;, it&rsquo;s what I was about to use because I thought of writing something in Vietnamese in the future, but as I see my characters are not preserved (I expected only partly though), for now I will skip it.</li></ul><p>And as you might already see, <code>page.slug</code> still contains a bunch of special characters, which means that it is not slugified at all. So yes, <code>page.slug</code> is less sluggy than the URL.</p><h3 id=why-i-am-doing-this>Why I am doing this</h3><p>Back to the old post with a dot in its slug. When I used only <code>page.slug</code> for identifying which post a [Staticman]({% link _notes/staticman.md %}) comment belongs to, comments on that old post would end up in a directory with a dot in its name</p><blockquote><p>toggle-krunner-plasma-5.17</p></blockquote><p>However, the dot does not appear in the property name of the data object <code>site.data.comments</code> that Jekyll retrieves</p><blockquote><p>{&ldquo;toggle-krunner-plasma-517&rdquo;=>{&ldquo;entry&mldr;</p></blockquote><p>So when my code tried to get <code>site.data.comments[page.slug]</code>, nothing was returned.</p><p>How Jekyll converts the directory name is still unknown to me. For example, &ldquo;<em>{{page.slug | replace: &lsquo;</em>&rsquo;, &lsquo;_&rsquo;}}_&rdquo;, this post&rsquo;s slug, when read by Jekyll, appears as &ldquo;<em>jekyll__slg</em>&rdquo;, which shows that:</p><ul><li>Underscores are kept;</li><li>Asterisks, dots, and pluses are removed. At least ü&rsquo;s and ư&rsquo;s are also removed;</li><li>Spaces are changed to underscores.</li></ul><p>And that&rsquo;s all I know so far.</p><p>What I can do with my Staticman commenting function is to slugify <code>page.slug</code> both in the comment form to indicate which post this comment belongs to and in the comment list to tell which post&rsquo;s comments to get. And let&rsquo;s see if my comment (later) can be shown down there.</p><h3 id=side-effect-related-to-data-files>Side effect related to data files</h3><p>While playing around with the slug, I also got a problem with Jekyll being unable to sort some null object. By fixing this error, I found out that data files are read by Jekyll as properties of their folder as the object. To be clearer, consider a post &ldquo;How to slugify&rdquo; with the slug &ldquo;how-to-slugify&rdquo;. Its comments are placed as in this directory tree:</p><pre tabindex=0><code>.
├─ _data
│  └─ comments
│     ├─ how-to-slugify
│     │  ├─ entry1.yml
│     │  ├─ entry2.yml
│     │  └─ entry3.yml
│     ├─ ...
</code></pre><p>and the data are read into this object <code>site.data.comments</code> as</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;how-to-slugify&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;entry1&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>...</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;entry2&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>...</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;entry3&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>...</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#a40000>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> 
</span></span></code></pre></div><p>So when I passed the object <code>site.data.comments[slug]</code> to a <code>sort</code> filter, it&rsquo;s not an array and the filter threw an error.</p><p>I went on and converted these properties into an array of comment objects. You can see more <a href=https://github.com/PhuNH/phunh.github.io/blob/source/_includes/comments.html>here</a>.<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>assign</span> <span style=color:#000>props_array</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>&#39;&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000>split</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>&#39;&#39;</span> <span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>entry</span> <span style=color:#000>in</span> <span style=color:#000>site</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>comments</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>slug</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span><span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>assign</span> <span style=color:#000>props_array</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>props_array</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000>concat</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>entry</span> <span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>endfor</span> <span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>assign</span> <span style=color:#000>comments_array</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>props_array</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000>where_exp</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;entry&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;entry[&#39;_id&#39;] != nil&#34;</span> <span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>assign</span> <span style=color:#000>first_level</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>comments_array</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000>where_exp</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;item&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;item.reply_to == &#39;&#39;&#34;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000>sort</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>&#39;</span><span style=color:#000>date</span><span style=color:#a40000>&#39;</span> <span style=color:#ce5c00;font-weight:700>%</span><span style=color:#000;font-weight:700>}</span></span></span></code></pre></div></p><p>Basically, using Liquid, you cannot create an array directly, but only split a string to create a string array. So I did the trick of splitting an empty string and then concatenated each property to the resulting array. The concatenated properties, however, also contains property names (&ldquo;entry1&rdquo;, &ldquo;entry2&rdquo;, &ldquo;entry3&rdquo; in the example) as separate array elements, so I filtered them out using a <code>where_exp</code> filter to check for the &ldquo;_id&rdquo; property in each element.</p><p>There is however still one thing I don&rsquo;t understand about this problem with Liquid: <code>site.data.comments[slug]</code> after a filter (e.g. <code>where_exp: "item", "item.reply_to == ''"</code>) is shown to be an array, just like our <code>first_level</code> array variable above, but I still cannot sort it. It would be nice to know why. Anyway, off to the comment section.</p><footer><a class=next href=https://phunh.github.io/posts/upgrade-f31-kde/>Next >></a>
<a href=https://phunh.github.io/posts/problem-grubby-f31/>&lt;&lt; Prev</a></footer></article></main><footer id=footer><div>Copyright © 2022 Phu Hung Nguyen</div><div>Foo or Phu? - Interesting and/or useful things (to me)</div><div><a href=https://github.com/phunh target=_blank>GitHub</a>
● <a href=https://twitter.com/phuhnguyen target=_blank>Twitter</a></div></footer></body></html>