<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Interesting and/or useful things (to me)"><link rel="shortcut icon" href=https://phunh.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.609872059387950283d8b6ce9f9f1d1d35946704e753486966b9b6d2afe0ccc3.css><title>Staticman</title></head><body><header id=banner><h2><a href=https://phunh.github.io/notes/staticman/>Staticman</a></h2><nav><ul><li><a href=https://phunh.github.io>home</a></li><li><a href=/posts/>posts</a></li><li><a class=active href=/notes/>notes</a></li><li><a href=/tags/>tags</a></li><li><a href=/about/>about</a></li></ul></nav></header><main id=content><article><header id=post-header><small><time>Last updated: 13 May 2020</time></small><div class=tagline>Phu
&emsp;|&emsp;2 minutes&emsp;|&emsp;Tags:
&nbsp;<a class=tag href=/tags/staticman/>staticman</a>
&nbsp;<a class=tag href=/tags/jekyll/>jekyll</a>
&nbsp;<a class=tag href=/tags/akismet/>akismet</a></div></header><h3 id=structure>Structure</h3><p>Staticman is the middle man who pushes comments on a GH site as commits from an account (let&rsquo;s call it Staticman-account) to the site&rsquo;s repo. The Staticman-account and repo&rsquo;s account can be the same but are <a href=https://travisdowns.github.io/blog/2020/02/05/now-with-comments.html#set-up-github-bot-account>suggested</a> to be different. A token or a GitHub app is required to make a commit from the Staticman-account and to read a config file in the site&rsquo;s repo, the <em>staticman.yml</em> file.</p><ul><li><em>app.json</em>: describes Staticman so Heroku knows how to install and deploy it,</li><li><em>config.js</em>: manages configs of Staticman,</li><li><em>config.{ENV}.yml</em>: contains config values for Staticman, env vars can be used instead,</li><li><em>*ocker*</em>: for installing and deploying Staticman using Docker,</li><li><em>siteConfig.js</em>: manages configs of Staticman for the site,</li><li><em>staticman.sample.yml</em>: a sample to create <em>staticman.yml</em> which is the site config file and must be put in the site&rsquo;s repo.</li><li><em>staticman_key.pub</em>: key to encrypt sensitive fields in the site config file <em>staticman.yml</em>.</li></ul><h3 id=for-v2>For v2</h3><ul><li>Scope of the token: <code>public_repo</code> is enough if the site repo is public, otherwise <code>repo</code> is needed for accessing a private repo.<ul><li>Travis Downs in <a href=https://travisdowns.github.io/blog/2020/02/05/now-with-comments.html#generate-personal-access-token>his blog post</a> wrote that <code>user</code> is necessary: so far I don&rsquo;t see the reason for that.</li><li>Ujjwal Verma <a href=https://gist.github.com/ujjwal96/70eabafefa8c2e3f5fa900f352f16c5e>noted</a> to use <code>admin:repo_hook</code>: the returned error code would be <code>GITHUB_CREATING_PR</code> which means that GitHub could not create a PR with this scope (when <code>moderation</code> is on). Or maybe he used a GitHub app instead of a token?</li></ul></li></ul><h3 id=other-notes>Other notes</h3><ul><li>Webhook payload URL is <code>/v1/webhook</code>. This function still works, even though the test request sent by GH after the webhook is added seems to fail.</li><li>The site URL set up on Akismet and the <code>akismet.site</code> config should both be the URL of where you host Staticman. The comment form sends form data to Staticman at this URL, Akismet also tries to catch spams at this URL, those <code>akismet</code> fields in <em>staticman.yml</em> are for Akismet to know what data it receives.</li></ul></article></main><footer id=footer><div>Copyright © 2022 Phu Hung Nguyen</div><div>Foo or Phu? - Interesting and/or useful things (to me)</div><div><a href=https://github.com/phunh target=_blank>GitHub</a>
● <a href=https://twitter.com/phuhnguyen target=_blank>Twitter</a></div></footer></body></html>